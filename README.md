# ChatGPT Archive Explorer (локальный)

Локальный импорт и просмотр экспорта ChatGPT: файлы раскладываются по проектам/gizmo, к ним генерируются Markdown/HTML, строится полнотекстовый индекс SQLite, а UI работает офлайн.

## Возможности

- Импорт распакованной папки или `.zip` экспорта (авто-распаковка в temp), поддержка нескольких аккаунтов через `--account/--source`.
- Группировка по `gizmo_id` (`projects/<account>/<project_id>/…`), конвертация в `conversation.json`, `conversation.md`, `conversation.html`, Obsidian-ready `conversation-obsidian.md`.
- Копирование вложенных изображений `file_*` из экспорта в `images/` и автоматическая подстановка в HTML/Markdown.
- SQLite `index.db` с FTS5: поиск по сообщениям и заголовкам, фильтры по аккаунту, проекту, модели (Chat / Research).
- Управление из веб-UI: переименование проекта, перенос чата в другой проект (внутри аккаунта), удаление чата, экспорт чатов в `.txt`, копирование JSON/Markdown/TXT/PATH.
- Импорт новых архивов из UI: сканирует `.zip` в корне архива и добавляет в выбранный аккаунт (append по умолчанию).

## Требования

- Python 3.10+ со сборкой SQLite, где включён FTS5 (обычный CPython на Windows/macOS/Linux подходит).
- Внешние зависимости не требуются; запускается командой `python -m chatgpt_archive.cli …`.

## Структура архива

```
<ArchiveRoot>/
  index.db
  projects/
    <account>/<project_id>/
      _meta.json
      <YYYY-MM-DD - title>/
        conversation.json
        conversation.md
        conversation.html
        conversation-obsidian.md
        images/               # скопированные file_* из экспорта (если были)
project_overrides.json        # хранится на уровень выше корня архива
```

- `conversation.json` содержит `conversation_uid` (`<account>:<id>`), `project_uid` (`<account>:<gizmo_id>`), метаданные и сообщения.
- `_meta.json` обновляется после импорта; `human_name` можно править вручную или через UI («Переименовать проект»). Значения хранятся в `project_overrides.json`, чтобы переживать полные переимпорты.

## CLI

```bash
# Импорт распакованного экспорта
python -m chatgpt_archive.cli import "D:\ChatGPT-export" --output "D:\ChatGPT-Archive" --account personal

# Импорт .zip, добавление в другой аккаунт без затирания существующего
python -m chatgpt_archive.cli import "D:\ChatGPT-export-work.zip" --output "D:\ChatGPT-Archive" --account work --incremental

# Запуск локального сервера
python -m chatgpt_archive.cli serve --root "D:\ChatGPT-Archive" --port 8000
# UI: http://127.0.0.1:8000
```

Флаги импорта:

- `export_path` — путь к папке или `.zip` экспорта (ищет `conversations.json`, допускает вложенную папку).
- `--output` — корень архива (создается при необходимости).
- `--account/--source` — имя аккаунта/источника, попадает в пути и ключи (`default`, если не указано).
- `--incremental` — append-режим: сохраняет существующие данные, обновляет/добавляет новые чаты, пропуская более старые `updated_at`. По умолчанию пересоздаёт схему `index.db` и перезаписывает папки найденных чатов; для полного wipe воспользуйтесь сбросом в UI.
- `--allow-network-images` — зарезервировано (добавление сетевых картинок пока не реализовано).

## Веб-UI

- Фильтры: текстовый поиск (FTS), аккаунт, проект, модель (`Chat` / `Research`). Сортировка — по дате обновления, новые сверху.
- Перенос чатов: кнопка ↕ позволяет перенести чат в другой проект того же аккаунта (обновляются файлы и индекс, сохраняется override для следующего импорта).
- Переименование проекта: доступно в селекте «Действия», сохраняется в `project_overrides.json` и `_meta.json`.
- Удаление чата: корзина в заголовке чата удаляет папку, запись в БД и связанные overrides.
- Экспорт `.txt`: «Скачать проект» или «Скачать все» собирает сообщения (User/Assistant) в один текстовый файл.
- Импорт из UI: положите `.zip` экспорта в корень архива, нажмите «Добавить архив», выберите аккаунт и режим (append включён по умолчанию).
- «Удалить архив»: очищает `projects/` и `index.db` (+ WAL файлы); `project_overrides.json` рядом с архивом не трогает, чтобы сохранить переименования/переносы.
- Кнопки Copy: JSON, Markdown, TXT (plain), PATH (web-путь) для текущего чата.

## Ограничения и особенности

- В индекс попадают только роли `user` и `assistant`; system/tool и CoT/`reasoning_status` сообщения скрываются.
- Удаляются инлайн-маркеры ChatGPT (`...`, `cite`, `finance`, `【...】`), чтобы не шумели в тексте.
- Изображения берутся только из локальных `file_*` в экспорте; скачивание по удалённым ссылкам не делается.
- При полном переимпорте папки «старых» чатов, которых нет в новом экспорте, могут остаться на диске; используйте «Удалить архив» для чистого состояния.
- Перенос чатов между разными аккаунтами через UI не поддерживается.
